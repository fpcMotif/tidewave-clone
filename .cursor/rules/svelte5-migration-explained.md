# ä¸ºä»€ä¹ˆ Svelte 5 Runes è¿ç§»ä¼šå¤±è´¥ï¼Ÿæ·±åº¦è§£æ

## ğŸ¯ æ ¸å¿ƒé—®é¢˜æ€»ç»“

ä½ åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°å›°éš¾å’Œå¤±è´¥çš„ä¸»è¦åŸå› ï¼š

### 1. **æ€ç»´æ¨¡å¼è½¬æ¢å›°éš¾** ğŸ’­

**ä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾ï¼Ÿ**
- Svelte 4 ä½¿ç”¨**ç¼–è¯‘æ—¶å“åº”å¼**ï¼ˆç¼–è¯‘å™¨åˆ†æä»£ç ï¼‰
- Svelte 5 ä½¿ç”¨**è¿è¡Œæ—¶å“åº”å¼**ï¼ˆè¿è¡Œæ—¶è¿½è¸ªä¾èµ–ï¼‰
- è¿™æ˜¯**æ ¹æœ¬æ€§çš„æ¶æ„å˜åŒ–**ï¼Œä¸åªæ˜¯è¯­æ³•ç³–

**å…·ä½“è¡¨ç°ï¼š**
```svelte
<!-- Svelte 4 æ€ç»´ï¼šç¼–è¯‘å™¨çœ‹åˆ° let å°±çŸ¥é“æ˜¯å“åº”å¼ -->
let count = 0;  // ç¼–è¯‘å™¨ï¼šè¿™æ˜¯å“åº”å¼çš„ï¼

<!-- Svelte 5 æ€ç»´ï¼šå¿…é¡»æ˜¾å¼å‘Šè¯‰è¿è¡Œæ—¶ -->
let count = $state(0);  // è¿è¡Œæ—¶ï¼šè¿™æ˜¯å“åº”å¼çš„ï¼
```

### 2. **ä¸ä¸€è‡´çš„è½¬æ¢** âš ï¸

**å¸¸è§é”™è¯¯æ¨¡å¼ï¼š**

```svelte
<!-- âŒ å¤±è´¥æ¡ˆä¾‹ï¼šéƒ¨åˆ†è½¬æ¢ -->
<script>
  // è½¬æ¢äº†è¿™ä¸ª
  let count = $state(0);
  
  // ä½†å¿˜è®°è½¬æ¢è¿™ä¸ª
  export let title;  // â† é—ç•™è¯­æ³•ï¼
  
  // ä¹Ÿå¿˜è®°è½¬æ¢è¿™ä¸ª
  $: doubled = count * 2;  // â† é—ç•™è¯­æ³•ï¼
</script>
```

**ä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Ÿ**
- Svelte ç¼–è¯‘å™¨æ£€æµ‹åˆ°**æ··åˆæ¨¡å¼**
- ä¸€æ—¦æœ‰ runesï¼Œå°±è¿›å…¥ "runes æ¨¡å¼"
- runes æ¨¡å¼ä¸‹ï¼Œé—ç•™è¯­æ³•ä¸å†æœ‰æ•ˆ
- ç»“æœï¼šç¼–è¯‘é”™è¯¯æˆ–è¿è¡Œæ—¶é”™è¯¯

### 3. **const vs let é™·é˜±** ğŸª¤

**æœ€å¸¸è§çš„å¤±è´¥åŸå› ä¹‹ä¸€ï¼š**

```svelte
<!-- âŒ è¿™ä¼šç¼–è¯‘å¤±è´¥ -->
<script>
const scrollRef = $state();
</script>
<div bind:this={scrollRef}>  <!-- é”™è¯¯ï¼ -->
```

**ä¸ºä»€ä¹ˆï¼Ÿ**
- `bind:this` éœ€è¦**å¯é‡æ–°èµ‹å€¼**çš„å˜é‡
- `const` åˆ›å»ºçš„æ˜¯**ä¸å¯é‡æ–°èµ‹å€¼**çš„ç»‘å®š
- å³ä½¿ `$state()` è¿”å›çš„å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œç»‘å®šæœ¬èº«éœ€è¦ `let`

**æ­£ç¡®åšæ³•ï¼š**
```svelte
<!-- âœ… æ­£ç¡® -->
<script>
let scrollRef = $state();
</script>
<div bind:this={scrollRef}>
```

### 4. **è¯¯è§£ $derived å’Œ $effect** ğŸ”„

**å¸¸è§æ··æ·†ï¼š**

```svelte
<!-- âŒ é”™è¯¯ï¼šç”¨ $derived åšå‰¯ä½œç”¨ -->
<script>
let count = $state(0);
const logger = $derived(() => {
  console.log(count);  // å‰¯ä½œç”¨ï¼
  return count;
});
</script>

<!-- âœ… æ­£ç¡®ï¼šç”¨ $effect åšå‰¯ä½œç”¨ -->
<script>
let count = $state(0);
$effect(() => {
  console.log(count);  // è¿™æ‰å¯¹
});
</script>
```

**å…³é”®åŒºåˆ«ï¼š**
- `$derived` = **è®¡ç®—æ–°å€¼**ï¼ˆçº¯å‡½æ•°ï¼Œè¿”å›ç»“æœï¼‰
- `$effect` = **æ‰§è¡Œå‰¯ä½œç”¨**ï¼ˆä¸è¿”å›å€¼ï¼Œæˆ–è¿”å›æ¸…ç†å‡½æ•°ï¼‰

### 5. **Slots è½¬æ¢å¤æ‚æ€§** ğŸ°

**ä¸ºä»€ä¹ˆ slots â†’ snippets éš¾ï¼Ÿ**

```svelte
<!-- çœ‹èµ·æ¥ç®€å• -->
<slot />  â†’  {@render children?.()}

<!-- ä½†å®é™…ä¸Šéœ€è¦åŒæ—¶æ”¹ä¸¤ä¸ªåœ°æ–¹ -->

<!-- å­ç»„ä»¶éœ€è¦æ”¹ -->
<script>
let { children } = $props();  // â† å¿…é¡»å£°æ˜
</script>
{@render children?.()}

<!-- çˆ¶ç»„ä»¶ä¹Ÿè¦æ”¹ï¼ˆå¦‚æœæ˜¯å‘½å slotï¼‰ -->
<div slot="header">  â†’  {#snippet header()}<div>{/snippet}
```

**å¤±è´¥åŸå› ï¼š**
- åªæ”¹äº†å­ç»„ä»¶ï¼Œå¿˜è®°æ”¹çˆ¶ç»„ä»¶
- æˆ–åè¿‡æ¥
- å¯¼è‡´ç±»å‹ä¸åŒ¹é…æˆ–è¿è¡Œæ—¶é”™è¯¯

### 6. **äº‹ä»¶ç³»ç»Ÿå˜åŒ–** ğŸ“¡

**æ€ç»´æ¨¡å¼è½¬æ¢ï¼š**

```svelte
<!-- Svelte 4: äº‹ä»¶æ˜¯ç‰¹æ®Šçš„ -->
<button on:click={handler}>

<!-- Svelte 5: äº‹ä»¶å°±æ˜¯ props -->
<button onclick={handler}>
```

**ç»„ä»¶äº‹ä»¶æ›´å¤æ‚ï¼š**

```svelte
<!-- Svelte 4: åˆ›å»º dispatcher -->
import { createEventDispatcher } from 'svelte';
const dispatch = createEventDispatcher();
dispatch('message', data);

<!-- Svelte 5: å›è°ƒ prop -->
let { onmessage } = $props();
onmessage(data);
```

**å¤±è´¥ç‚¹ï¼š**
- å¿˜è®°æŠŠ `e.detail` æ”¹ä¸ºç›´æ¥å‚æ•°
- çˆ¶ç»„ä»¶ä»ä½¿ç”¨ `on:event` è¯­æ³•
- æ²¡æœ‰æ›´æ–°äº‹ä»¶å¤„ç†å™¨ç­¾å

### 7. **TypeScript ç±»å‹è¿‡æ—¶** ğŸ“

```typescript
// âŒ ä½¿ç”¨æ—§ç±»å‹
import type { SvelteComponent } from 'svelte';
let component: typeof SvelteComponent;

// âœ… ä½¿ç”¨æ–°ç±»å‹
import type { Component } from 'svelte';
let component: Component<{ props: string }>;
```

---

## ğŸ‰ ä¸ºä»€ä¹ˆæœ€ç»ˆä¼šæˆåŠŸï¼Ÿ

### æˆåŠŸçš„å…³é”®å› ç´ ï¼š

#### 1. **ç³»ç»Ÿæ€§æ–¹æ³•** ğŸ“Š

```
ä¸æ˜¯é›¶æ•£ä¿®æ”¹ï¼Œè€Œæ˜¯ï¼š
1. è¯†åˆ«æ‰€æœ‰é—ç•™è¯­æ³•
2. åˆ›å»ºè½¬æ¢æ¸…å•
3. ä¸€æ¬¡æ€§å…¨éƒ¨è½¬æ¢
4. éªŒè¯å®Œæ•´æ€§
```

#### 2. **æ­£ç¡®çš„è½¬æ¢é¡ºåº** ğŸ”¢

```
æ­£ç¡®é¡ºåºï¼š
1ï¸âƒ£ å…ˆè½¬æ¢ Props (export let â†’ $props)
2ï¸âƒ£ å†è½¬æ¢çŠ¶æ€ (let â†’ $state)  
3ï¸âƒ£ ç„¶åæ´¾ç”Ÿå€¼ ($: value = â†’ $derived)
4ï¸âƒ£ æ¥ç€å‰¯ä½œç”¨ ($: {} â†’ $effect)
5ï¸âƒ£ ä¿®å¤ç»‘å®š (const â†’ let for bind:this)
6ï¸âƒ£ è½¬æ¢äº‹ä»¶ (on: â†’ onevent)
7ï¸âƒ£ æœ€åå¤„ç† slots (slot â†’ snippet)
```

#### 3. **ç†è§£æ¦‚å¿µæ˜ å°„** ğŸ—ºï¸

| Svelte 4 | Svelte 5 | ç”¨é€” |
|----------|----------|------|
| `let variable` | `let variable = $state()` | å“åº”å¼çŠ¶æ€ |
| `export let prop` | `let { prop } = $props()` | ç»„ä»¶å±æ€§ |
| `$: derived = ...` | `const derived = $derived(...)` | æ´¾ç”Ÿå€¼ |
| `$: { effect }` | `$effect(() => { effect })` | å‰¯ä½œç”¨ |
| `on:event` | `onevent` | DOM äº‹ä»¶ |
| `dispatch('event')` | `onevent()` callback | ç»„ä»¶äº‹ä»¶ |
| `<slot>` | `{@render children()}` | å†…å®¹æ’æ§½ |
| `beforeUpdate` | `$effect.pre()` | æ›´æ–°å‰ |
| `afterUpdate` | `$effect()` | æ›´æ–°å |

#### 4. **ä½¿ç”¨è¿ç§»å·¥å…·** ğŸ› ï¸

```bash
# è‡ªåŠ¨åŒ–å¤§éƒ¨åˆ†è½¬æ¢
npx sv migrate svelte-5
```

**å·¥å…·èƒ½åšä»€ä¹ˆï¼š**
- âœ… è‡ªåŠ¨è½¬æ¢å¤§éƒ¨åˆ†è¯­æ³•
- âœ… è¯†åˆ«å¸¸è§æ¨¡å¼
- âœ… ä¿ç•™ TypeScript ç±»å‹

**å·¥å…·ä¸èƒ½åšä»€ä¹ˆï¼š**
- âŒ å¤æ‚çš„äº‹ä»¶å¤„ç†é€»è¾‘
- âŒ è‡ªå®šä¹‰çš„å“åº”å¼æ¨¡å¼
- âŒ éœ€è¦äººå·¥åˆ¤æ–­çš„è¾¹ç¼˜æ¡ˆä¾‹

#### 5. **æµ‹è¯•é©±åŠ¨è¿ç§»** ğŸ§ª

```
æˆåŠŸæµç¨‹ï¼š
1. è¿è¡Œè¿ç§»å·¥å…·
2. ç¼–è¯‘æ£€æŸ¥
3. ä¿®å¤ç¼–è¯‘é”™è¯¯
4. è¿è¡Œæµ‹è¯•
5. ä¿®å¤è¿è¡Œæ—¶é”™è¯¯
6. æ‰‹åŠ¨æµ‹è¯• UI
7. ç¡®è®¤åŠŸèƒ½æ­£å¸¸
```

---

## ğŸ” å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹ 1: æ¸¸æˆåˆ—è¡¨ç»„ä»¶å¤±è´¥ â†’ æˆåŠŸ

**å¤±è´¥ç‰ˆæœ¬ï¼š**
```svelte
<script>
  import { gamesData } from '$lib/constants';
  let scrollRef = $state();  // âœ… ç”¨äº† let
</script>

<!-- âŒ é—®é¢˜ï¼šgamesData æ²¡åŒ…è£…ï¼Œä¸å“åº”å¼ -->
<div bind:this={scrollRef}>
  {#each gamesData.games as game}
    <GameCard {game} />
  {/each}
</div>
```

**ä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿ**
- `gamesData` æ˜¯æ™®é€šå¯¼å…¥ï¼Œä¸å“åº”å¼
- å¦‚æœæ•°æ®å˜åŒ–ï¼ŒUI ä¸ä¼šæ›´æ–°
- æ··åˆäº†æ–°æ—§æ€ç»´

**æˆåŠŸç‰ˆæœ¬ï¼š**
```svelte
<script>
  import { gamesData as imported } from '$lib/constants';
  const gamesData = $state(imported);  // âœ… åŒ…è£…ä¸ºå“åº”å¼
  let scrollRef = $state();
</script>

<div bind:this={scrollRef}>
  {#each gamesData.games as game}
    <GameCard {game} />
  {/each}
</div>
```

### æ¡ˆä¾‹ 2: è¡¨å•ç»„ä»¶å¤±è´¥ â†’ æˆåŠŸ

**å¤±è´¥ç‰ˆæœ¬ï¼š**
```svelte
<script>
  // âŒ æ··åˆè¯­æ³•
  export let value;  // é—ç•™
  let error = $state('');  // Runes
  
  // âŒ é—ç•™è¯­æ³•åœ¨ runes æ¨¡å¼æ— æ•ˆ
  $: isValid = value.length > 0;
</script>

<input bind:value on:input={validate}>
<!--      â†‘ é—ç•™                â†‘ é—ç•™ -->
```

**ä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿ**
- æœ‰ `$state` å°±è¿›å…¥ runes æ¨¡å¼
- runes æ¨¡å¼ä¸‹ `export let` æ— æ•ˆ
- runes æ¨¡å¼ä¸‹ `$:` æ— æ•ˆ
- äº‹ä»¶ç”¨äº†æ—§è¯­æ³•

**æˆåŠŸç‰ˆæœ¬ï¼š**
```svelte
<script>
  let { value = $bindable() } = $props();  // âœ… å®Œæ•´è½¬æ¢
  let error = $state('');
  
  const isValid = $derived(value.length > 0);  // âœ… ä½¿ç”¨ $derived
  
  function validate() {
    error = isValid ? '' : 'Required';
  }
</script>

<input bind:value oninput={validate}>
<!--              â†‘ æ–°è¯­æ³• -->
```

### æ¡ˆä¾‹ 3: æ¨¡æ€æ¡†ç»„ä»¶å¤±è´¥ â†’ æˆåŠŸ

**å¤±è´¥ç‰ˆæœ¬ï¼š**
```svelte
<script>
  import { createEventDispatcher } from 'svelte';
  const dispatch = createEventDispatcher();
  
  let { isOpen } = $props();  // âœ… æ–°è¯­æ³•
  
  function close() {
    dispatch('close');  // âŒ é—ç•™æ–¹å¼
  }
</script>

{#if isOpen}
  <div class="modal">
    <slot />  <!-- âŒ é—ç•™è¯­æ³• -->
    <button on:click={close}>Close</button>
    <!--           â†‘ é—ç•™è¯­æ³• -->
  </div>
{/if}
```

**ä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿ**
- æ··ç”¨ `$props()` å’Œ `createEventDispatcher`
- æ²¡æœ‰è½¬æ¢ slots
- äº‹ä»¶è¯­æ³•ä¸ä¸€è‡´

**æˆåŠŸç‰ˆæœ¬ï¼š**
```svelte
<script>
  let { 
    isOpen, 
    onclose,      // âœ… å›è°ƒ prop
    children      // âœ… snippet prop
  } = $props();
  
  function close() {
    onclose();    // âœ… ç›´æ¥è°ƒç”¨
  }
</script>

{#if isOpen}
  <div class="modal">
    {@render children?.()}  <!-- âœ… render snippet -->
    <button onclick={close}>Close</button>
    <!--       â†‘ æ–°è¯­æ³• -->
  </div>
{/if}
```

---

## ğŸ’¡ å…³é”®ç»éªŒæ•™è®­

### 1. **"å…¨æœ‰æˆ–å…¨æ— "åŸåˆ™**
- ä¸è¦éƒ¨åˆ†è½¬æ¢
- ä¸€æ—¦å¼€å§‹ï¼Œå°±å®Œæ•´è½¬æ¢æ•´ä¸ªç»„ä»¶
- æ£€æŸ¥æ¸…å•ç¡®ä¿æ²¡æœ‰é—æ¼

### 2. **"ç¼–è¯‘å™¨æ˜¯æœ‹å‹"**
- ç¼–è¯‘é”™è¯¯æ˜¯å¸®åŠ©ï¼Œä¸æ˜¯é˜»ç¢
- æ¯ä¸ªé”™è¯¯éƒ½æŒ‡å‘éœ€è¦ä¿®å¤çš„åœ°æ–¹
- ä¿®å¤ä¸€ä¸ªé”™è¯¯å¯èƒ½æš´éœ²ä¸‹ä¸€ä¸ª

### 3. **"ç†è§£èƒœè¿‡è®°å¿†"**
- ä¸æ˜¯è®°ä½è½¬æ¢è§„åˆ™
- è€Œæ˜¯ç†è§£å“åº”å¼ç³»ç»Ÿå˜åŒ–
- çŸ¥é“ä¸ºä»€ä¹ˆè¿™æ ·è½¬æ¢

### 4. **"å·¥å…· + äººå·¥"**
- è¿ç§»å·¥å…·å®Œæˆ 80%
- äººå·¥å¤„ç†å‰©ä½™ 20%
- ä¸è¦ç›²ç›®ä¾èµ–å·¥å…·

### 5. **"æµ‹è¯•æ˜¯å…³é”®"**
- æ¯æ¬¡è½¬æ¢åæµ‹è¯•
- ä¸è¦ç§¯ç´¯é—®é¢˜
- é€æ­¥éªŒè¯åŠŸèƒ½

---

## ğŸ“ˆ ä»å¤±è´¥åˆ°æˆåŠŸçš„è·¯å¾„

```
ç¬¬ä¸€æ¬¡å°è¯• âŒ
â”œâ”€ éƒ¨åˆ†è½¬æ¢ props
â”œâ”€ å¿˜è®°è½¬æ¢ $:
â”œâ”€ const + bind:this é”™è¯¯
â””â”€ ç¼–è¯‘å¤±è´¥

ç¬¬äºŒæ¬¡å°è¯• âŒ  
â”œâ”€ è½¬æ¢äº†æ‰€æœ‰è¯­æ³•
â”œâ”€ ä½†æ²¡è½¬æ¢çˆ¶ç»„ä»¶çš„ slots
â””â”€ è¿è¡Œæ—¶é”™è¯¯

ç¬¬ä¸‰æ¬¡å°è¯• âŒ
â”œâ”€ è½¬æ¢äº† slots
â”œâ”€ ä½†äº‹ä»¶å¤„ç†å™¨ç­¾åä¸å¯¹
â””â”€ åŠŸèƒ½å¼‚å¸¸

ç¬¬å››æ¬¡å°è¯• âœ…
â”œâ”€ ä½¿ç”¨è¿ç§»å·¥å…·
â”œâ”€ ç³»ç»Ÿæ€§æ£€æŸ¥
â”œâ”€ å®Œæ•´è½¬æ¢
â”œâ”€ æµ‹è¯•éªŒè¯
â””â”€ æˆåŠŸï¼
```

---

## ğŸ“ æœ€ä½³å®è·µæ€»ç»“

### è¿ç§»å‰ï¼š
1. âœ… å¤‡ä»½ä»£ç ï¼ˆgit commitï¼‰
2. âœ… é˜…è¯»è¿ç§»æŒ‡å—
3. âœ… ç†è§£æ ¸å¿ƒæ¦‚å¿µå˜åŒ–
4. âœ… å‡†å¤‡æµ‹è¯•ç¯å¢ƒ

### è¿ç§»ä¸­ï¼š
1. âœ… ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·
2. âœ… ä¸€æ¬¡ä¸€ä¸ªç»„ä»¶
3. âœ… éµå¾ªè½¬æ¢æ¸…å•
4. âœ… ä¿®å¤æ‰€æœ‰ç¼–è¯‘é”™è¯¯

### è¿ç§»åï¼š
1. âœ… è¿è¡Œæ‰€æœ‰æµ‹è¯•
2. âœ… æ‰‹åŠ¨æµ‹è¯•åŠŸèƒ½
3. âœ… æ£€æŸ¥æ€§èƒ½
4. âœ… æ›´æ–°æ–‡æ¡£

---

## ğŸš€ ç°åœ¨ä½ çŸ¥é“äº†

**ä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼š**
- éƒ¨åˆ†è½¬æ¢ï¼ˆæ··åˆè¯­æ³•ï¼‰
- const/let ä½¿ç”¨é”™è¯¯  
- æ¦‚å¿µç†è§£ä¸æ¸…
- é—æ¼çˆ¶ç»„ä»¶ä¿®æ”¹
- äº‹ä»¶ç³»ç»Ÿæ··æ·†

**ä¸ºä»€ä¹ˆä¼šæˆåŠŸï¼š**
- ç³»ç»Ÿæ€§å®Œæ•´è½¬æ¢
- æ­£ç¡®çš„è½¬æ¢é¡ºåº
- ç†è§£æ¦‚å¿µæ˜ å°„
- ä½¿ç”¨è¿ç§»å·¥å…·
- æµ‹è¯•é©±åŠ¨éªŒè¯

**å…³é”®æ˜¯ï¼š** ä¸æ˜¯è¯­æ³•çš„ç®€å•æ›¿æ¢ï¼Œè€Œæ˜¯**å“åº”å¼ç³»ç»Ÿçš„æ€ç»´è½¬å˜**ã€‚

Svelte 5 çš„ Runes æ›´æ˜¾å¼ã€æ›´å¯é¢„æµ‹ã€æ€§èƒ½æ›´å¥½ã€‚ä¸€æ—¦ç†è§£äº†è¿™ä¸ªè½¬å˜ï¼Œè¿ç§»å°±å˜å¾—ç®€å•äº†ã€‚

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [Svelte 5 Runes å®˜æ–¹æ–‡æ¡£](https://svelte.dev/docs/svelte/runes)
- [è¿ç§»æŒ‡å—å®Œæ•´ç‰ˆ](https://svelte.dev/docs/svelte/v5-migration-guide)  
- [Runes è®¾è®¡ç†å¿µ](https://svelte.dev/blog/runes)

---

**è®°ä½ï¼šå¤±è´¥æ˜¯å­¦ä¹ çš„ä¸€éƒ¨åˆ†ã€‚æ¯æ¬¡å¤±è´¥éƒ½è®©ä½ æ›´æ¥è¿‘æˆåŠŸï¼** ğŸ¯

